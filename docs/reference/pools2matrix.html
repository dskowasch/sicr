<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert pools to matrix — pools2matrix • sicr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert pools to matrix — pools2matrix"><meta name="description" content="This function reduces the complexity of the pools structure by converting it to a matrix to sample from. See details
for more information."><meta property="og:description" content="This function reduces the complexity of the pools structure by converting it to a matrix to sample from. See details
for more information."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sicr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/sicr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Convert pools to matrix</h1>

      <div class="d-none name"><code>pools2matrix.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function reduces the complexity of the pools structure by converting it to a matrix to sample from. See details
for more information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pools2matrix</span><span class="op">(</span><span class="va">pools</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-pools">pools<a class="anchor" aria-label="anchor" href="#arg-pools"></a></dt>
<dd><p>List as output of <code><a href="generate_pools.html">generate_pools()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List of three objects representing the pools, see details.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The list <code>pools</code> contains the objects <code>pretail_pools</code>, <code>tail_pools</code> and <code>pool_of_annuities</code>. The first two are lists
that contain lists themselves that contain pools per development year and reserve class. This format makes it
easy to get a good overview of a pool by accessing it via the assigned indices of the lists. But on the other side,
this format doesn't allow for vectorized sampling. <br>
Hence this function turns the first two objects of <code>pools</code> into a <code>sample_matrix</code>. This matrix contains 7 columns
that are needed for sampling, that is <code>Ind_cl_payment_cal</code>, <code>Exit_reserve_class</code>, <code>New_annuity_1</code>, ...,
<code>New_annuity_5</code>. The rows of the pools are appended to the matrix, starting
with reserve class 0 and development year 2, continuing with reserve class 0 and development year 3 to <code>tail_start - 1</code>
and the same procedure with the other reserve classes. The tail pools are attached at the end. <br><br>
As different pool sizes make it hard to find the start and the end of a pool in this matrix, every pool gets assigned
the same number of rows, and that is the maximum size of all pools. Every row that does not belong to the
original pool is set to 0. <br><br><strong>Example:</strong> A setup consisting of the reserve classes 0 to 3 and the development years 2 to 16 plus tail will
result in \(4 * (15 + 1) = 64\) pools. If the maximum size of the pools is 1.000 rows, each pool will be assigned 1.000
rows in <code>sample_matrix</code>, so the matrix has dimension <code>(64.000, 7)</code>. <br><br>
Of course not every pool is of this maximum size, so the vector <code>lengths_vector</code> is created which contains the sizes
of every pool. <br><br>
The first row of the pool in <code>sample_matrix</code> is calculated by</p>
<p>$$
row_1 =
\left\{
   \begin{array}{l}
      \bigl(rc \cdot \left( tail_1 - 2 \right) + dy - 2 \bigr) \cdot n_{pool,\ max} + 1 \quad \text{for pretail pools } \\
      \bigl(n_{rc} \cdot \left( tail_1 - 2 \right) + rc \bigr) \cdot n_{pool,\ max} + 1 \quad \text{for tail pools}
   \end{array}
\right.
$$
where
$$
\begin{array}{l}
   rc \quad \text{is the reserve class} \\
   dy \quad \text{is the desired development year} \\
   tail_1 \quad \text{is the first tail year} \\
   n_{rc} \quad \text{is the number of reserve classes and} \\
   n_{pool,\ max} \quad \text{is the maximum pool size}
\end{array}
$$</p>
<p>The rows to sample from can be derived from \(row_1\) and the corresponding entry of <code>lengths_vector</code>. The function
<code><a href="get_matrix_info.html">get_matrix_info()</a></code> returns these values.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># this example uses data provided with this package</span></span></span>
<span class="r-in"><span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepare_data.html">prepare_data</a></span><span class="op">(</span>claims_data <span class="op">=</span> <span class="va">minimal_claims_data_xmpl</span>,</span></span>
<span class="r-in"><span>                         indices <span class="op">=</span> <span class="va">indices_xmpl</span>,</span></span>
<span class="r-in"><span>                         threshold <span class="op">=</span> <span class="fl">400000</span>,</span></span>
<span class="r-in"><span>                         first_orig_year <span class="op">=</span> <span class="fl">1989</span>,</span></span>
<span class="r-in"><span>                         last_orig_year <span class="op">=</span> <span class="fl">2023</span>,</span></span>
<span class="r-in"><span>                         expected_year_of_growing_large <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                         reserve_classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200001</span>, <span class="fl">400001</span>, <span class="fl">700001</span>, <span class="fl">1400001</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         pool_of_annuities <span class="op">=</span> <span class="va">minimal_pool_of_annuities_xmpl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pools</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_pools.html">generate_pools</a></span><span class="op">(</span>extended_claims_data <span class="op">=</span> <span class="va">new_data</span>,</span></span>
<span class="r-in"><span>                        reserve_classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200001</span>, <span class="fl">400001</span>, <span class="fl">700001</span>, <span class="fl">1400001</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        years_for_pools <span class="op">=</span> <span class="fl">2014</span><span class="op">:</span><span class="fl">2023</span>,</span></span>
<span class="r-in"><span>                        start_of_tail <span class="op">=</span> <span class="fl">17</span>,</span></span>
<span class="r-in"><span>                        end_of_tail <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>                        lower_outlier_limit <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span></span>
<span class="r-in"><span>                        upper_outlier_limit <span class="op">=</span> <span class="cn">Inf</span>,</span></span>
<span class="r-in"><span>                        pool_of_annuities <span class="op">=</span> <span class="va">minimal_pool_of_annuities_xmpl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pools_as_matrix</span> <span class="op">&lt;-</span> <span class="fu">pools2matrix</span><span class="op">(</span><span class="va">pools</span><span class="op">)</span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dirk Skowasch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

